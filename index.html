<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fraudulent Allegations Companies Database</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="max-w-3xl mx-auto p-6 bg-white shadow-md rounded-lg mt-10">
    <h1 class="text-3xl font-bold text-red-600 text-center mb-2">
      Nigeria Scam Allegations Companies Database
    </h1>
    <h2 class="text-center text-gray-600 text-lg mb-6">
      A public petition archive to warn others and encourage accountability
    </h2>

    <input
      type="text"
      id="searchBox"
      placeholder="Search company..Sujimoto..Pwan"
      class="w-full px-4 py-3 border border-gray-300 rounded-md mb-4 focus:outline-none focus:ring-2 focus:ring-red-400"
    />

    <ul id="results" class="border border-gray-300 rounded-md max-h-48 overflow-y-auto bg-gray-50 divide-y divide-gray-200 mb-6"></ul>

    <div class="bg-yellow-100 border-l-4 border-yellow-500 p-4 rounded-md mb-4">
      <p>
        Our mission is to provide a transparent, community-driven platform that establishes and displays live petitions against rogue companies alleged to have defrauded individuals. By sharing verified evidence and petitions here, we help warn the public and promote accountability.
      </p>
    </div>

    <div class="bg-yellow-100 border-l-4 border-yellow-500 p-4 rounded-md mb-6">
      <p class="mb-2">
        <strong>Have you been scammed by a Real Estate Company in Lagos?</strong><br />
        Send your evidence of payment to 
        <a href="https://wa.me/2347077513836" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">ADMIN</a>.
        A <strong>PETITION</strong> to EFCC will be automatically created for you, and the company name and petition will be made live on this website to <strong>WARN</strong> others.
      </p>
      <p>
        <strong>Does your Company appear on this list?</strong><br />
        To get your company name removed from this database, contact 
        <a href="https://wa.me/2347077513836" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">ADMIN</a>,
        providing evidence that you have <strong>SUFFICIENTLY</strong> clarified and paid out the fraudulent allegations against your company. Once the petitioner <strong>CONFIRMS</strong> receipt, your company will be removed within 24 hours.
      </p>
    </div>
  </div>

  <!-- PDF Viewer Container -->
  <div id="pdfViewerContainer" class="hidden fixed inset-0 z-50 bg-white overflow-y-auto p-6">
    <div class="flex justify-end mb-4">
      <button onclick="closeViewer()" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 mr-2">
        Close
      </button>
      <button onclick="toggleUploadForm()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
        Submit a New Petition
      </button>
    </div>

    <!-- Petition Upload Form -->
    <form id="uploadForm" class="hidden space-y-4 bg-gray-100 p-6 rounded-lg" enctype="multipart/form-data">
      <input
        type="text"
        name="name"
        placeholder="Your Full Name"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-md"
      />
      <input
        type="email"
        name="email"
        placeholder="Your Email Address"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-md"
      />
      <textarea
        name="details"
        placeholder="Brief details of how you were scammed..."
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-md"
        rows="4"
      ></textarea>
      <input
        type="file"
        name="attachments"
        multiple
        accept=".pdf,image/*"
        class="w-full"
      />
      <input type="hidden" name="company" id="selectedCompany" />
      <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700">
        Send New Petition
      </button>
    </form>

    <div
      id="confirmationMessage"
      class="hidden mt-6 p-4 bg-green-100 border border-green-400 text-green-800 font-semibold text-center rounded-md"
    >
      Thank you for sending your new Petition against the company you have an issue with.<br />
      The petition will be made live on the website within 24 hours to warn others.
    </div>

    <div id="pdfContent" class="mt-6"></div>
  </div>

  


  <script>
    const searchBox = document.getElementById("searchBox");
    const resultsList = document.getElementById("results");
    const pdfViewerContainer = document.getElementById("pdfViewerContainer");
    const pdfContent = document.getElementById("pdfContent");
    const uploadForm = document.getElementById("uploadForm");
    const selectedCompanyInput = document.getElementById("selectedCompany");

    let companies = [];

    fetch('data/companies.json')
      .then(res => res.json())
      .then(data => companies = data);

    searchBox.addEventListener('input', () => {
      const query = searchBox.value.toLowerCase();
      resultsList.innerHTML = '';
      if (!query) return;

      companies
        .filter(c => c.name.toLowerCase().includes(query))
        .forEach(company => {
          const li = document.createElement('li');
          li.textContent = company.name;
          li.onclick = () => showPetitions(company);
          resultsList.appendChild(li);
        });
    });

    function showPetitions(company) {
      selectedCompanyInput.value = company.name;
      pdfViewerContainer.classList.remove("hidden");
      pdfContent.innerHTML = `<h2>${company.heading}</h2>`;

      company.petitions.forEach(petition => {
        const label = document.createElement('p');
        label.innerHTML = `<strong>${petition.title}</strong>`;

        const viewBtn = document.createElement('button');
        viewBtn.textContent = "View PDF";
        viewBtn.onclick = () => window.open(petition.file, '_blank');

        const downloadBtn = document.createElement('button');
        downloadBtn.textContent = "Download PDF";
        downloadBtn.onclick = () => {
          const a = document.createElement('a');
          a.href = petition.file;
          a.download = '';
          a.click();
        };

        pdfContent.appendChild(label);
        pdfContent.appendChild(viewBtn);
        pdfContent.appendChild(downloadBtn);
      });
    }

    function closeViewer() {
      pdfViewerContainer.classList.add("hidden");
      pdfContent.innerHTML = '';
      uploadForm.classList.add("hidden");
    }

    function toggleUploadForm() {
      uploadForm.classList.toggle("hidden");
    }

    uploadForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(uploadForm);

      const response = await fetch('https://petitionwebsite.onrender.com/submit', {
        method: 'POST',
        body: formData,
      });

      if (response.ok) {
        uploadForm.reset();
        uploadForm.classList.add("hidden");

        const confirmationMessage = document.getElementById("confirmationMessage");
        confirmationMessage.style.display = "block";

        setTimeout(() => {
          confirmationMessage.style.display = "none";
        }, 5000);
      } else {
        alert('Failed to submit petition.');
      }
    });
  </script>
</body>
</html>
